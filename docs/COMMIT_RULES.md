# Git コミットルール

## 基本フォーマット

```
コミット種別: 要約

変更した理由（内容、詳細）
```

## 詳細説明

### 1 行目：変更内容の要約

- コミット種別と要約を記載
- フォーマット：`コミット種別: 要約`

### 2 行目：空行

### 3 行目以降：変更した理由

- 変更した理由を具体的に記載
- チケット連携がある場合は紐付け情報を含める

## コミット種別

### 通常版

- `fix`：バグ修正
- `hotfix`：クリティカルなバグ修正
- `add`：新規（ファイル）機能追加
- `update`：機能修正（バグではない）
- `change`：仕様変更
- `clean`：整理（リファクタリング等）
- `disable`：無効化（コメントアウト等）
- `remove`：削除（ファイル）
- `upgrade`：バージョンアップ
- `revert`：変更取り消し

### ライト版（簡略化）

- `fix`：バグ修正
- `add`：新規（ファイル）機能追加
- `update`：機能修正（バグではない）
- `remove`：削除（ファイル）

## コミット例

```
fix: 削除フラグが更新されない不具合の修正

refs #110 更新SQLの対象カラムに削除フラグが含まれていなかったため追加しました。
```

```
add: ソート機能の即座ローディング表示機能を追加

ソートボタンクリック時のローディング表示遅延を解消するため、
usePaginationフックにisTransitioning状態を追加し、
クリック瞬間にローディング状態を開始するよう改善。
```

```
update: ユーザー一覧画面のページネーション機能を改善

1ページあたりの表示件数をユーザーが選択できるように変更。
10件、25件、50件、100件から選択可能。
```

```
clean: 未使用のインポートとコンポーネントを削除

ESLintの警告に従い、使用されていないインポート文と
デッドコードになっていたコンポーネントを削除。
```

## 運用方針

- **言語**：日本語
- **要約**：シンプルかつ分かりやすく記載
- **理由**：変更した背景や詳細を具体的に記載
- **チケット連携**：refs #番号 形式でチケットと紐付け
- **署名**：Claude Codeによる自動生成署名は付けない

## Graphicaプロジェクトでの追加ルール

### プロジェクト固有のコミット種別

- `ui`：UIコンポーネントの追加・修正
- `api`：API関連の変更
- `db`：データベーススキーマやマイグレーションの変更
- `i18n`：多言語対応の追加・修正
- `auth`：認証・認可関連の変更
- `test`：テストコードの追加・修正
- `docs`：ドキュメントの更新
- `perf`：パフォーマンス改善
- `style`：コードスタイルの変更（機能に影響しない）

### コミット例（Graphica固有）

```
ui: クライアントダッシュボードのデザイン改善

カード間の余白を調整し、モバイル表示時のレイアウトを最適化。
アイコンを追加してユーザビリティを向上。
```

```
db: マルチテナント対応のためcompanyIdカラムを追加

各テーブルにcompanyIdカラムを追加し、
企業ごとのデータ分離を実現。
インデックスも追加してパフォーマンスを確保。
```

```
i18n: 英語翻訳の追加と日本語メッセージの改善

管理画面の英語翻訳を追加。
エラーメッセージをより分かりやすい日本語に修正。
```

```
perf: デザイナーダッシュボードのクエリを最適化

サブクエリをバッチクエリに変更し、N+1問題を解決。
Promise.allで並列実行することで読み込み速度を改善。
```

### ブランチ戦略との連携

- `main`：本番環境
- `develop`：開発環境
- `feature/*`：新機能開発
- `fix/*`：バグ修正
- `hotfix/*`：緊急修正

### コミットメッセージのベストプラクティス

1. **具体的に書く**：「修正」ではなく「ログイン時のメールアドレス検証エラーを修正」
2. **理由を明記**：なぜその変更が必要だったのかを説明
3. **影響範囲を示す**：どの機能・画面に影響があるか記載
4. **関連情報を含める**：Issue番号、PR番号、参考URLなど

### 避けるべきコミットメッセージ

- ❌ `fix: バグ修正`
- ❌ `update: 更新`
- ❌ `add: 追加`
- ❌ `wip`
- ❌ `tmp`

### 良いコミットメッセージ

- ✅ `fix: プロジェクト作成時の画像アップロードエラーを修正`
- ✅ `add: デザイナー向けの案件フィルタリング機能を追加`
- ✅ `update: 納期表示を相対時間から絶対日時に変更`
- ✅ `perf: プロジェクト一覧のクエリを最適化（N+1問題を解決）`

## コード整形ルール

### コミット前の必須事項

コミットする前に、**必ず**以下のツールでコードを整形してください：

1. **ESLint**: コードの問題を検出・修正
   ```bash
   pnpm lint
   ```

2. **Prettier**: コードフォーマットの統一
   ```bash
   pnpm format
   ```

3. **TypeScript型チェック**: 型エラーの確認
   ```bash
   pnpm type-check
   ```

### 自動整形の設定

VSCodeを使用している場合は、以下の設定で保存時に自動整形されます：

```json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  }
}
```

### コミット前チェックリスト

- [ ] ESLintエラーがないこと
- [ ] Prettierでフォーマット済みであること
- [ ] TypeScriptの型エラーがないこと
- [ ] テストが通ること（該当する場合）
- [ ] コミットメッセージが規約に従っていること

### 整形されていないコードのコミットは禁止

整形されていないコードがコミットされた場合：
- PRレビューで差し戻されます
- CIでエラーになります
- 他の開発者に迷惑がかかります

**必ず整形してからコミットしてください。**

### Linter/Prettierによる自動整形

このプロジェクトでは、コミット時にLinterとPrettierが自動的にコードを整形します。
手動で整形する必要がある場合は、以下のコマンドを実行してください：

```bash
# すべてのファイルを整形
pnpm format

# TypeScriptファイルのみ整形
pnpm lint --fix
```

## ブランチ運用ルール

### releaseブランチの扱い

releaseブランチは本番環境デプロイ用の特別なブランチです。以下のルールを厳守してください：

1. **releaseブランチでの直接編集禁止**
   - releaseブランチでファイルの編集や修正を行わない
   - すべての変更はmainブランチで行い、マージする

2. **ビルドエラーチェック必須**
   - releaseブランチにマージする前に、**必ず**ビルドが成功することを確認
   - 以下のコマンドでビルドエラーがないことを確認：
   ```bash
   pnpm build
   ```

3. **マージ手順**
   ```bash
   # 1. mainブランチで作業
   git checkout main
   # 2. ビルドエラーがないことを確認
   pnpm build
   # 3. ビルドが成功したらreleaseブランチにマージ
   git checkout release
   git merge main --no-edit
   git push origin release
   # 4. mainブランチに戻る
   git checkout main
   ```

4. **緊急時の対応**
   - どうしても緊急でreleaseブランチで修正が必要な場合は、修正後すぐにmainブランチにマージバックする
   - ただし、これは例外的な対応であり、通常は避けるべき

### なぜこのルールが重要か

- releaseブランチは本番環境に直結しているため、常に安定した状態を保つ必要がある
- ビルドエラーがあるコードをデプロイすると、本番環境が動作しなくなる
- mainブランチで開発・テストを行うことで、品質を担保できる